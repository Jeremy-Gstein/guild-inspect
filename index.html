<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WoW Raid Frames</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat">
  <style>
    /* Add your CSS styling for the raid frames and popup here */
    body {
        background: url('https://64.media.tumblr.com/1a2a8c82361222daa020e21400bef88d/tumblr_pbr3nbNVtc1xzkabyo1_1280.gifv') center/cover no-repeat fixed;
        font-family: "Montserrat";
    }
    p {
        color: #000000;
        font-family: "Montserrat";
    }
    h1 { 
        color: #000;
        font-family: "Montserrat";
    }
    h2 {
        color: #000;
        font-family: "Montserrat";
    }
    h3 {
        color: #000;
        font-family: "Montserrat";
    }
    h4 { 
        color: #000;
        font-family: "Montserrat";
    }
    
    .raid-frame {
      width: 250px;
      height: 125px;
      border: 1px solid #cccccc88;
      margin: 2px;
      display: inline-block;
      text-align: center;
      cursor: pointer;
    }

    .mana-bar {
      height: 10px;
      width: 100%;
    }

    #popup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 20px;
      background-color: #7c7975bb;
      border: 1px solid #3f3d3d;
      font-family: "Montserrat";
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
      z-index: 1000;
      max-height: 80vh;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <div id="raidFramesContainer"></div>

  <div>
    <label for="playerName">Player Name:</label>
    <input type="text" id="playerName" placeholder="Enter player name">
    <label for="playerClass">Player Class:</label>
    <select id="playerClass">
      <option value="DeathKnight">#C41E3A (Death Knight)</option>
      <option value="DemonHunter">#A330C9 (Demon Hunter)</option>
      <option value="Druid">#FF7C0A (Druid)</option>
      <option value="Evoker">#33937F (Evoker)</option>
      <option value="Hunter">#AAD372 (Hunter)</option>
      <option value="Mage">#3FC7EB (Mage)</option>
      <option value="Monk">#00FF98 (Monk)</option>
      <option value="Paladin">#F48CBA (Paladin)</option>
      <option value="Priest">#FFFFFF (Priest)</option>
      <option value="Rogue">#FFF468 (Rogue)</option>
      <option value="Shaman">#0070DD (Shaman)</option>
      <option value="Warlock">#8788EE (Warlock)</option>
      <option value="Warrior">#C69B6D (Warrior)</option>
    </select>
    <button onclick="addPlayer()">Add Player</button>
  </div>

  <div id="popup"></div>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const raidFramesContainer = document.getElementById("raidFramesContainer");
      const playerNameInput = document.getElementById("playerName");
      const playerClassSelect = document.getElementById("playerClass");
      const popup = document.getElementById("popup");

      // Class colors
      const classColors = {
        DeathKnight: "#C41E3A",
        DemonHunter: "#A330C9",
        Druid: "#FF7C0A",
        Evoker: "#33937F",
        Hunter: "#AAD372",
        Mage: "#3FC7EB",
        Monk: "#00FF98",
        Paladin: "#F48CBA",
        Priest: "#FFFFFF",
        Rogue: "#FFF468",
        Shaman: "#0070DD",
        Warlock: "#8788EE",
        Warrior: "#C69B6D"
      };

      // Predefined raid group
      const predefinedRaidGroup = [
        { name: "Shodo", class: "Paladin" },
        { name: "Mishern", class: "Shaman" },
        { name: "Notshodo", class: "Evoker" },
        { name: "Fleed", class: "DemonHunter" },
        { name: "Bouziedk", class: "DeathKnight" },
        { name: "Hypixyl", class: "Priest" },
        { name: "Liliru", class: "Evoker" },
        { name: "Spectralguy", class: "Priest" },
        { name: "Fidz", class: "Druid" },
        { name: "Demonann", class: "DemonHunter" },
        { name: "Freyalyse", class: "Hunter" },
        { name: "Safari", class: "Druid" },
        { name: "Draasin", class: "Evoker" },
        // Add more players as needed
      ];

      // Simulating initial players
      const players = [...predefinedRaidGroup];

      // Create raid frames
      function renderRaidFrames() {
        raidFramesContainer.innerHTML = "";
        players.forEach(player => {
          const raidFrame = document.createElement("div");
          raidFrame.className = "raid-frame";
          raidFrame.textContent = player.name;
          raidFrame.style.backgroundColor = classColors[player.class];

          const manaBar = document.createElement("div");
          manaBar.className = "mana-bar";
          manaBar.style.backgroundColor = classColors[player.class];
          raidFrame.appendChild(manaBar);

          // Add click event listener
          raidFrame.addEventListener("click", () => handleRaidFrameClick(player));

          raidFramesContainer.appendChild(raidFrame);
        });
      }

      // Function to handle raid frame click
      function handleRaidFrameClick(player) {
        // Use the character name and class for the API request
        const apiUrl = `https://raider.io/api/v1/characters/profile?region=us&realm=Proudmoore&name=${player.name}&fields=mythic_plus_recent_runs`;

        fetch(apiUrl)
          .then(response => response.json())
          .then(data => {
            displayCharacterInfo(player, data);
          })
          .catch(error => console.error('Error fetching data:', error));
      }

      function displayCharacterInfo(player, character) {
        // Generate HTML for recent runs
        const recentRunsHTML = generateRecentRunsHTML(character.mythic_plus_recent_runs);

        // Display the character information in the popup
        const popupContent = `
          <span onclick="closePopup()" style="cursor: pointer; position: absolute; top: 10px; right: 10px; font-size: 20px;">&times;</span>
          <h2>${player.name} - ${player.class}</h2>
          <img src="${character.thumbnail_url}" alt="Character Thumbnail">
          <p>Race: ${character.race}</p>
          <p>Class: ${character.class}</p>
          <p>Spec: ${character.active_spec_name}</p>
          <p>Role: ${character.active_spec_role}</p>
          <p>Achievement Points: ${character.achievement_points}</p>
          <p>Last Crawled At: ${character.last_crawled_at}</p>
          <p>Profile URL: <a href="${character.profile_url}" target="_blank">${character.profile_url}</a></p>
          
          <h3>Mythic Plus Recent Runs</h3>
          ${recentRunsHTML}
        `;

        // Set the popup content
        popup.innerHTML = popupContent;

        // Show the popup
        popup.style.display = "block";

        // Add an event listener to close the popup when clicking outside of it
        document.addEventListener("click", handleOutsideClick);

        // Function to close the popup
        function handleOutsideClick(event) {
          if (!popup.contains(event.target)) {
            // Click outside the popup, close it
            closePopup();
            // Remove the event listener after closing the popup
            document.removeEventListener("click", handleOutsideClick);
          }
        }
      }

      // Function to generate HTML for recent runs
      function generateRecentRunsHTML(recentRuns) {
        return recentRuns.map(run => `
          <p>Dungeon: ${run.dungeon}</p>
          <p>Mythic Level: ${run.mythic_level}</p>
          <p>Completed At: ${run.completed_at}</p>
          <p>Clear Time (ms): ${run.clear_time_ms}</p>
          <p>Par Time (ms): ${run.par_time_ms}</p>
          <p>Num Keystone Upgrades: ${run.num_keystone_upgrades}</p>
          
          <p>Affixes:</p>
          <ul>
            ${run.affixes.map(affix => `<li>${affix.name}: ${affix.description}</li>`).join('')}
          </ul>

          <p>URL: <a href="${run.url}" target="_blank">${run.url}</a></p>
          <hr>
        `).join('');
      }

      // Function to add a new player
      window.addPlayer = function() {
        const playerName = playerNameInput.value.trim();
        const playerClass = playerClassSelect.value;
        if (playerName && playerClass) {
          const newPlayer = { id: players.length + 1, name: playerName, class: playerClass };
          players.push(newPlayer);
          playerNameInput.value = ""; // Clear input fields
          playerClassSelect.value = "";
          renderRaidFrames();
        }
      };

      // Function to close the popup
      window.closePopup = function() {
        const popup = document.getElementById("popup");
        popup.style.display = "none";
      };

      // Initial rendering
      renderRaidFrames();
    });

  </script>
</body>
</html>
